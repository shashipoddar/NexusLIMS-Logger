
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Session Logging &#8212; NexusLIMS-Logger  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Administrator Documentation" href="admin_doc.html" />
    <link rel="prev" title="NexusLIMS-Logger" href="readme.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="session-logging">
<h1>Session Logging<a class="headerlink" href="#session-logging" title="Permalink to this headline">¶</a></h1>
<p>To accurately know what files should be included in each Experiment’s record,
it is important to have a timestamp for the beginning <cite>and</cite> end of when a user
has collected data. To facilitate collecting this information, a small
application has been written that is run from the microscope support (or
control) PC and logs basic session information to the
NexusLIMS database. This document explains how this
application is used, its design, what information it collects, and how it is
deployed to the individual microscopes.</p>
<section id="how-to-use-the-logger-gui">
<h2>How to use the Logger GUI<a class="headerlink" href="#how-to-use-the-logger-gui" title="Permalink to this headline">¶</a></h2>
<p>Using the Logger GUI is very simple. The program can be run as an executable file or through a command line.
Directions for installing and configuring the Logger GUI can be found
<a class="reference internal" href="readme.html"><span class="doc">here</span></a>. When the Logger GUI is started, there will be a short delay (about 5 seconds, depending on the instrument)
and a display window will appear on the user’s screen, shown below.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/logger_icon_new.PNG"><img alt="Session Logger application shortcut icon" src="_images/logger_icon_new.PNG" style="width: 25%;" /></a>
</figure>
<p>The laptop name and date/time the Logger GUI was opened are shown in blue font, and there are four buttons at the bottom called
<code class="docutils literal notranslate"><span class="pre">Copy</span> <span class="pre">Data</span></code>, <code class="docutils literal notranslate"><span class="pre">End</span> <span class="pre">session</span></code>, <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">Session</span> <span class="pre">Note</span></code>, and <code class="docutils literal notranslate"><span class="pre">Show</span> <span class="pre">Debug</span> <span class="pre">Log</span></code>.  Once this window is displayed,
the user should simply keep the window open while they work (minimizing the window is no problem).  The Logger
GUI does not perform any actions during this stage, and is simply waiting for the user to click the <code class="docutils literal notranslate"><span class="pre">End</span> <span class="pre">session</span></code> button.
Before the <code class="docutils literal notranslate"><span class="pre">End</span> <span class="pre">session</span></code> button is clicked, the user has the option to add notes to the active session by clicking
the <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">Session</span> <span class="pre">Note</span></code> button.</p>
<p>When the user has finished collecting data, they will click the <code class="docutils literal notranslate"><span class="pre">End</span> <span class="pre">session</span></code> button in the window. This will trigger
the application to label the current experiment as finished in the <a class="reference external" href="https://euclid-techlabs-llc.github.io/NexusLIMS/database.html">database</a>,
and the Logger GUI will close by itself after a short delay.</p>
<section id="what-if-something-goes-wrong">
<h3>What if something goes wrong?<a class="headerlink" href="#what-if-something-goes-wrong" title="Permalink to this headline">¶</a></h3>
<p>In the event that the Logger GUI encounteres an error, it will inform the user and a pop-up debugging log with
more information will appear (this log can also be accessed by clicking the <code class="docutils literal notranslate"><span class="pre">Show</span> <span class="pre">Debug</span> <span class="pre">Log</span></code> button).</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/logger_log.png"><img alt="Session Logger application in action" src="_images/logger_log.png" style="width: 30%;" /></a>
</figure>
</section>
<section id="interrupted-sessions">
<span id="interrupted"></span><h3>Interrupted sessions<a class="headerlink" href="#interrupted-sessions" title="Permalink to this headline">¶</a></h3>
<p>If the Logger GUI window is manually closed during a session, another window will appear that asks the user if they would
like to cancel closing the window, pause the session, or end the session.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/logger_pause_session.png"><img alt="Session Logger pause session option" src="_images/logger_pause_session.png" style="width: 50%;" /></a>
</figure>
<p>Clicking on <code class="docutils literal notranslate"><span class="pre">Pause</span> <span class="pre">Session</span></code> will immediatly close the Logger GUI without sending any further information
to the database.  The <code class="docutils literal notranslate"><span class="pre">Pause</span> <span class="pre">Session</span></code> button should only be clicked if the user plans to resume the session
before another user would use the same instrument (i.e. they need to restart their computer). If an instrument session
is paused but the <code class="docutils literal notranslate"><span class="pre">End</span> <span class="pre">session</span></code> button is never clicked, the next time the Logger GUI is run the user will be
prompted to confirm whether they want to continue the existing session or start a new one.</p>
</section>
</section>
<section id="actions-performed-by-the-logger-gui">
<h2>Actions performed by the Logger GUI<a class="headerlink" href="#actions-performed-by-the-logger-gui" title="Permalink to this headline">¶</a></h2>
<p>The NexusLIMS Logger GUI performs a number of steps to record that an
Experiment has occurred, and keeps the progress bar up to date while it is
operating. These steps are detailed below.</p>
<section id="mounting-the-network-share">
<span id="step-1"></span><h3>1. Mounting the network share<a class="headerlink" href="#mounting-the-network-share" title="Permalink to this headline">¶</a></h3>
<p>The first action performed by the Logger GUI is to “ping” the central file server
where data is saved and the NexusLIMS database is stored. This action initiates when the
Logger Gui is opened. Based on the response, the logger stores the IP address of this server (to avoid problems
with the DNS server). The Logger GUI then looks at the currently mounted drives on
the microscope computer and picks a drive letter that is not in use. With this
information, the program runs a Windows command to mount the drive. When this
action is completed, the Logger GUI confirms that the database file can be accessed,
and raises an error if not.</p>
</section>
<section id="getting-the-instrument-name">
<h3>2. Getting the instrument name<a class="headerlink" href="#getting-the-instrument-name" title="Permalink to this headline">¶</a></h3>
<p>Using the database file on the mounted drive, the Logger GUI queries
the <code class="docutils literal notranslate"><span class="pre">instruments</span></code> table in the database using the <cite>“hostname”</cite> of the current
computer. In this way, a computer name gets mapped to an instrument persistent
identifier (PID) and this value is stored for later use. Directions for finding
your computers <cite>“hostname”</cite> can be found <a class="reference external" href="https://drexel.edu/it/help/a-z/computer-names/">here</a>.</p>
<p>If the <cite>“hostname”</cite> of the user’s computer does not match any computer names
specified in the <a class="reference external" href="https://euclid-techlabs-llc.github.io/NexusLIMS/database.html">database</a>,
the Logger GUI will be unable to map the computer name to an instrument persistent identifier (PID)
and an error message will appear.</p>
</section>
<section id="checking-instrument-status">
<h3>3. Checking instrument status<a class="headerlink" href="#checking-instrument-status" title="Permalink to this headline">¶</a></h3>
<p>Before logging the start of a new Experiment, first the Logger GUI
checks to ensure that the most recent entry logged for this instrument was
an <code class="docutils literal notranslate"><span class="pre">'END'</span></code> entry, meaning that the last session was marked as finished.
For example, the code runs a query such as the following to get the most
recent entry (that was not a record generation event):</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">event_type</span><span class="p">,</span> <span class="n">session_identifier</span><span class="p">,</span> <span class="n">id_session_log</span><span class="p">,</span> <span class="k">timestamp</span>
<span class="k">FROM</span> <span class="n">session_log</span> <span class="k">WHERE</span> <span class="n">instrument</span> <span class="o">=</span> <span class="s1">&#39;Instrument ABC&#39;</span>
<span class="k">AND</span> <span class="k">NOT</span> <span class="n">event_type</span> <span class="o">=</span> <span class="s1">&#39;RECORD_GENERATION&#39;</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">timestamp</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>If this most recent entry is an <code class="docutils literal notranslate"><span class="pre">'END'</span></code>, the database is in its expected
normal state, and the application continues on as normal. If it is instead a
<code class="docutils literal notranslate"><span class="pre">'START'</span></code> entry, then the application asks the user
whether they want to continue the existing session found in the database, or
start a new one (see the <a class="reference internal" href="#interrupted">interrupted session</a> section for more
details). If the user chooses to continue the existing session, the Logger
GUI notes the session identifier from the database for that session and
jumps to <a class="reference internal" href="#step-6">step 6</a>.</p>
</section>
<section id="inserting-a-start-log">
<span id="step-4"></span><h3>4. Inserting a <code class="docutils literal notranslate"><span class="pre">START</span></code> log<a class="headerlink" href="#inserting-a-start-log" title="Permalink to this headline">¶</a></h3>
<p>With the instrument PID known and a randomly generated identifier string, the
Logger GUI runs a database insertion query on the <code class="docutils literal notranslate"><span class="pre">session_log</span></code> table to record
that a session has been started. While not explicitly specified in the query,
the current timestamp is also included in the insertion. As an example:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">session_log</span> <span class="p">(</span><span class="n">instrument</span><span class="p">,</span> <span class="n">event_type</span><span class="p">,</span>
                         <span class="n">session_identifier</span><span class="p">,</span> <span class="k">user</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Instrument ABC&#39;</span><span class="p">,</span> <span class="s1">&#39;START&#39;</span><span class="p">,</span>
        <span class="s1">&#39;c9b774c9-4a59-4154-af05-0e2477e57cc4&#39;</span><span class="p">,</span> <span class="s1">&#39;local_user&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>After this has finished, the Logger GUI runs another query to verify that the row
was inserted into the database as expected, and raises an error if not.</p>
</section>
<section id="unmounting-the-network-share">
<h3>5. Unmounting the network share<a class="headerlink" href="#unmounting-the-network-share" title="Permalink to this headline">¶</a></h3>
<p>After the session start log has been added, the network share created in step 1
is unmounted to clean up while the Logger GUI waits for the next
action. While the application is waiting, it simply sits idle until the
<cite>“End session”</cite> button is pressed.</p>
</section>
<section id="ending-the-session">
<span id="step-6"></span><h3>6. Ending the session<a class="headerlink" href="#ending-the-session" title="Permalink to this headline">¶</a></h3>
<p>Once the user clicks the <cite>“End session”</cite> button, the Logger GUI again
mounts the network share (as in <a class="reference internal" href="#step-1">step 1</a>) so it can communicate with
the NexusLIMS database. Using the same <cite>session identifier</cite>
value as before, the application inserts a corresponding <code class="docutils literal notranslate"><span class="pre">'END'</span></code> log into the
database using a query very similar to that in <a class="reference internal" href="#step-4">step 4</a>.
After verifying that this record was inserted correctly, the application
then updates the status of both the <code class="docutils literal notranslate"><span class="pre">'START'</span></code> and <code class="docutils literal notranslate"><span class="pre">'END'</span></code> logs for this
session from <code class="docutils literal notranslate"><span class="pre">'WAITING_FOR_END'</span></code> to <code class="docutils literal notranslate"><span class="pre">'TO_BE_BUILT'</span></code>. This status indicates
to the <a class="reference external" href="https://euclid-techlabs-llc.github.io/NexusLIMS/record_building.html">record builder</a>, that it should go ahead to
actually build and upload the record for this Experiment.</p>
</section>
<section id="cleaning-up">
<h3>7. Cleaning up<a class="headerlink" href="#cleaning-up" title="Permalink to this headline">¶</a></h3>
<p>After updating the logs in the previous step, the Logger GUI unmounts
the network share (as before), and if everything went according to plan,
waits three seconds and then shuts itself down. At this point, it is ready
to be run again by the next user that arrives to begin a new session.</p>
</section>
</section>
<section id="information-collected">
<h2>Information collected<a class="headerlink" href="#information-collected" title="Permalink to this headline">¶</a></h2>
<p>As described above and in the <a class="reference external" href="https://euclid-techlabs-llc.github.io/NexusLIMS/database.html">database</a>, the
Logger GUI collects the bare minimum amount of information required
to compile an Experiment’s record. The values collected from the microscope
computer that are recorded to the database with each log are:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">session_identifier</span></code></p></td>
<td><p>A random UUID4 (36-character string) that
is consistent among the record’s
record’s <code class="docutils literal notranslate"><span class="pre">&quot;START&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;END&quot;</span></code>, and
<code class="docutils literal notranslate"><span class="pre">&quot;RECORD_GENERATION&quot;</span></code> events.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">instrument</span></code></p></td>
<td><p>The instrument PID associated with
this microscope’s computer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">timestamp</span></code></p></td>
<td><p>The current date and time (in local time)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">event_type</span></code></p></td>
<td><p>The type of log for this session (either
<code class="docutils literal notranslate"><span class="pre">&quot;START&quot;</span></code> for the beginning of an Experiment,
or <code class="docutils literal notranslate"><span class="pre">&quot;END&quot;</span></code> for the end of one).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">record_status</span></code></p></td>
<td><p>The status of the record
associated with this session.
Its value is <code class="docutils literal notranslate"><span class="pre">&quot;WAITING_FOR_END&quot;</span></code> at first, but
is updated to <code class="docutils literal notranslate"><span class="pre">&quot;TO_BE_BUILT&quot;</span></code> after the
session has ended.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">user</span></code></p></td>
<td><p>The username of the currently logged in user
(often this is just <code class="docutils literal notranslate"><span class="pre">supervisor</span></code> or <code class="docutils literal notranslate"><span class="pre">admin</span></code>)</p></td>
</tr>
</tbody>
</table>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">NexusLIMS-Logger</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">Overview &amp; Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Logger GUI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#how-to-use-the-logger-gui">How to use the Logger GUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#actions-performed-by-the-logger-gui">Actions performed by the Logger GUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#information-collected">Information collected</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="admin_doc.html">Administrator Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">Module Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="readme.html" title="previous chapter">NexusLIMS-Logger</a></li>
      <li>Next: <a href="admin_doc.html" title="next chapter">Administrator Documentation</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Euclid Techlabs, NIST ODI.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/logger_gui.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>